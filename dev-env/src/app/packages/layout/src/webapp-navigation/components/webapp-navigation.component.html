<ng-template #webappNavHeaderWrapper>
  <ng-content select="bat-webapp-nav-heading"></ng-content>
</ng-template>

<ng-template #webappNavElementWrapper>
  <ng-content select="bat-webapp-element"></ng-content>
</ng-template>

<div
  class="bat-navigation"
  ngClass.lt-md="bat-navigation-lt-md"
  ngClass.gt-sm="bat-navigation-gt-sm"
  [@navigationLevels]="(mediaQueryService.isMobileMediaQuery$ | async) ? currentLevel : '1'"
  [@visibility]="visibilityState">
  <!--[style.transform-origin]="getTransformOriginStyle(transformOrigin.x, transformOrigin.y)"-->
  <div ngClass.lt-md="bat-navigation-strawler-lt-md" ngClass.gt-sm="bat-navigation-strawler-gt-sm">

    <div *ngIf="!(mediaQueryService.isMobileMediaQuery$ | async)">
      <ng-container
        batHeaderGenerator
        [mobileTemplate]="headingComponent.mobileTemplate"
        [desktopTemplate]="headingComponent.desktopTemplate"
        [headerTitle]="headingComponent.headerTitle"
        [level]="currentLevel"
        [mediaQuery]="mediaQueryService.mediaQuery$ | async"
        [navItems]="viewModel[''+ currentLevel].navItems"
        [parentNavItem]="viewModel[''+currentLevel].parentNavItem"
        [viewModel]="viewModel"
        [backClickFn]="wrap(goToPreviousLevel, level)"
        [closeClickFn]="">

      </ng-container>
    </div>

    <div class="bat-navigation-container"
         ngClass.lt-md="bat-navigation-container-lt-md"
         ngClass.gt-sm="bat-navigation-container-gt-sm"
         fxLayoutAlign.gt-sm="end"
         fxLayout.lt-md="row">

      <ng-container *ngFor="let level of objectKeys(viewModel)">
        <div ngClass.gt-sm="bat-navigation-level-gt-sm"
             ngClass.lt-md="bat-navigation-level-lt-md">

          <div *ngIf="(mediaQueryService.isMobileMediaQuery$ | async)">
            <ng-container
              batHeaderGenerator
              [mobileTemplate]="headingComponent.mobileTemplate"
              [desktopTemplate]="headingComponent.desktopTemplate"
              [headerTitle]="headingComponent.headerTitle"
              [level]="level"
              [mediaQuery]="mediaQueryService.mediaQuery$ | async"
              [navItems]="viewModel[level].navItems"
              [parentNavItem]="viewModel[level].parentNavItem"
              [viewModel]="viewModel"
              [backClickFn]="wrap(goToPreviousLevel,level)"
              [closeClickFn]="">

            </ng-container>

          </div>

          <div ngClass.lt-md="bat-navigation-element-container-lt-md">
            <!--[style.margin-top]="getMarginTopStyle(i)"-->
            <!--hide on mobile if there's a mobile template, hide desktop if there's a desktop template-->
            <div class="bat-navigation-element-divider" *ngIf="showDefaultDivider((mediaQueryService.mediaQuery$ | async), !!elementComponent.mobileTemplate, !!elementComponent.desktopTemplate)"></div>
            <ng-container *ngFor="let navItem of viewModel[level].navItems">

              <ng-container
                batNavElementGenerator
                [mobileTemplate]="elementComponent.mobileTemplate"
                [desktopTemplate]="elementComponent.desktopTemplate"
                [mediaQuery]="mediaQueryService.mediaQuery$ | async"
                [navItem]="navItem"
                [level]="level"
                [navElementClickFn]="wrap(goToNextLevel,navItem, level)"></ng-container>

              <div class="bat-navigation-element-divider" *ngIf="showDefaultDivider((mediaQueryService.mediaQuery$ | async), !!elementComponent.mobileTemplate, !!elementComponent.desktopTemplate)"></div>
            </ng-container>
          </div>
        </div>
      </ng-container>
    </div>

    <div class="bat-navigation-footer" fxLayoutAlign="start center">
      <ng-content select="bat-webapp-nav-footer"></ng-content>
    </div>
  </div>
</div>


